/*! Iframeupload - v0.1.0 - 2016-03-22
* https://github.com/seamys/iframeUpload
* Copyright (c) 2016 seamys; Licensed MIT */
!function(a){a.fn.iframeUpload=function(b){var c,d,e,f,g,h,i=this.eq(0),j={url:"",hidden:{tempKey:""},analysis:function(){},loading:"正在上传文件..."};j=a.extend({},j,b);var k={init:function(){this.isFile()&&(c=i.parents("form"),h=i.parent(),k.rootChange())},getIframe:function(){return f||(g="iframe_"+(new Date-0),f=a('<iframe id="'+g+'" name="'+g+'"></iframe>'),f.hide(),f.on("load",function(){var b;b=document.all?document.frames[g].document:document.getElementById(g).contentDocument;var c=a(b).text();""!==a.trim(c)&&j.analysis(c),k.clear()})),f},append:function(){d.append(k.getIframe()),k.getForm().append(i),d.append(e)},isFile:function(){return"file"===i.attr("type")},getForm:function(){return e||(e=a('<form action="'+j.url+'" method="post" enctype="multipart/form-data" target="'+g+'"> </form>'),a.each(j.hidden,function(b,c){a('<input type="hidden" name="'+b+'" value="'+c+'"/>').appendTo(e)})),e},rootChange:function(){i.on("change",function(){(0===c.length?k._onFormInit:k._FormInit)(),i.parent("form").submit()})},clear:function(){i.appendTo(h),e.remove(),f.remove(),f=null,e=null},_onFormInit:function(){d=h,k.append()},_FormInit:function(){d||(d=a("<span></span>"),d.hide()),c.after(d),k.append()}};return k.init(),this}}(jQuery);